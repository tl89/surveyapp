<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--#config errmsg="" --><!-- saved from url=(0022)http://help.adobe.com/ -->
<html lang="ja-jp">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="lang" content="ja-jp" />
    <meta name="area" content="livedocs" />
    <title>Adobe&#160;ColdFusion&#160; * サーバーモニタを使用したサーバーのパフォーマンスの向上</title>
    <link rel="shortcut icon" href="images/ColdFusionLinkIndicator.png" />
    <meta name="book" content="ColdFusion 10 設定と管理" />
    <meta name="product" content="ColdFusion" />
    <meta name="keywords" content="" /><!--<PageMap><DataObject type="document"><Attribute name="product" value="ColdFusion"></Attribute><Attribute name="book" value="ColdFusion 10 設定と管理"></Attribute><Attribute name="keywords" value=""></Attribute></DataObject></PageMap>-->
    
    <script type="text/javascript" language="Javascript" charset="UTF-8"><!--[CDATA[
        var currentTreeNode = "WSc3ff6d0ea77859461172e0811cbf363cdd-7fe2.html";
    document.cookie = "topicId=" + "WSc3ff6d0ea77859461172e0811cbf363cdd-7fe2.html";
// ]]--></script>
<script src="terms.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="help.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script>  <script src="utilities.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="event.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="treeview.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="toc.js" language="Javascript" type="text/javascript" charset="UTF-8">..</script> <script src="swfobject.js" language="Javascript" type="text/javascript" charset="UTF-8">..</script>  <script src="booklist.js" language="Javascript" type="text/javascript" charset="UTF-8">..</script>
<script type="text/javascript">
<!--[CDATA[
var topictype = "topic";
var headId = document.getElementsByTagName("head")[0];         
if (use_ie_6_behavior) {
  var linkId = document.createElement("link");
  linkId.href = "content-ie6.css";
  linkId.rel = "stylesheet";
  linkId.type = "text/css";
  headId.appendChild(linkId);
}
function initRoboHelpDOM() {
  if (use_chm_behavior) {
    hideElement("search");
  }
  if (use_robohelp_behavior) {
    hideElement("search");
    hideElement("productmenu");
    //hideElement("notyourversion");
  }
  if(!use_chc_behavior) {
    //document.getElementById("notyourversion").style.display = "inline";;
  }
}
var dirname = location.pathname.match( /.*\// );    
function setSearchUserPref(){
  if ( document.cookie.indexOf( "ah_searchpref" ) > -1 ) {
    if ( document.cookie.indexOf( dirname ) > 0 ) {
      document.search.gsa.checked = true ;
    }else{
      document.search.gsa.checked = false ;            
    }
  }
}
YAHOO.util.Event.onDOMReady(initRoboHelpDOM);
YAHOO.util.Event.onDOMReady(setSearchUserPref);
// ]]-->
</script>
<!--#include virtual="/ssi/globalheader.ssi" -->
<!--#include virtual="/ja_JP/ssi/localheader.ssi" -->
<!--#include virtual="header.ssi" -->
    <link rel="stylesheet" type="text/css" href="tree.css" />
    <link rel="stylesheet" type="text/css" href="content.css" />
    <link rel="stylesheet" type="text/css" href="localeSpecific.css" />
  </head>
  <body id="content_body" onload="window.focus();">
    <a name="top" shape="rect"><!--LeaveCommentHere--></a>
    
    
    
    

    



<!-- BEGIN PAGE CONTENT WRAPPER -->
    <div id="page_content_wrapper">
<!-- BEGIN PAGE WRAPPER -->
<table id="page_content_table">
<tr>
<!--#include virtual="recommendations_topic.ssi" -->
<td id="col2">
<!-- BEGIN CONTENT WRAPPER -->

      <div id="content_wrapper">
<!-- BEGIN PAGE TITLE -->
        <h1>サーバーモニタを使用したサーバーのパフォーマンスの向上</h1>
<!-- END PAGE TITLE -->

<table id="inner_content_table" width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td>
          <div style="border-top:#ccc solid 1px;"><p> </p>
          </div>
<!--#include virtual="contentheader.ssi" -->

          <div id="minitoc"><div class="t"><div class="b"><div><ul id="minitoc-links"><li><p><a href="#WS46CC9F7C-FDAE-4980-B7EE-E39BAC71D450"><span class="topictitle1">開発中のアプリケーションのボトルネックの発見</span>
</a></p></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbf363cdd-7fde"><span class="topictitle1">JVM メモリ使用量</span>
</a></p></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbf364104-7fb3"><span class="topictitle1">変数のメモリ使用量</span>
</a></p></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbf364104-7fb5"><span class="topictitle1">リクエストの処理</span>
</a></p></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbf364104-7fb6"><span class="topictitle1">キャッシュ</span>
</a></p></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbf364104-7fb4"><span class="topictitle1">データベース応答時間</span>
</a></p></li></ul></div></div></div></div><div><p>サーバーモニタは、ColdFusion サーバーのパフォーマンスの向上に役立つ情報を提供します。 </p>
<ul class="navlinklist"></ul>
</div>
<div id="WS46CC9F7C-FDAE-4980-B7EE-E39BAC71D450" class="nochunk"><a name="WS46CC9F7C-FDAE-4980-B7EE-E39BAC71D450"><!-- --></a><h2 class="topictitle2">開発中のアプリケーションのボトルネックの発見</h2><div><ol><li><p>監視、プロファイリング、およびメモリトラッキングを有効にします。</p>
</li>
<li><p>低速なリクエストおよびメモリ使用量の多いリクエストのレポートのしきい値をゼロ (0) に設定します。</p>
</li>
<li><p>テンプレートを実行します。</p>
</li>
<li><p>それぞれのリクエストに対して、次のものを見つけます。</p>
<ul><li><p>低速なリクエストのレポートで、低速なタグと関数。</p>
</li>
<li><p>メモリ使用量の多いリクエストのレポートで、最大の変数。</p>
</li>
</ul>
</li>
</ol>
</div></div>
<div id="WSc3ff6d0ea77859461172e0811cbf363cdd-7fde" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbf363cdd-7fde"><!-- --></a><h2 class="topictitle2">JVM メモリ使用量</h2><div><p>ColdFusion はエンタープライズ Java アプリケーションなので、パフォーマンスに最も影響するソフトウェアコンポーネントは JVM (Java Virtual Machine: Java 仮想マシン) です。異なるベンダの JVM や、同じベンダでもバージョンの異なる JVM は、パフォーマンスについて異なる特性を持っています。ColdFusion とともに使用している JVM を変更することで、パフォーマンスを向上できる可能性があります。 </p>
<p>ColdFusion には、アプリケーションサーバーとしての Tomcat の組み込みバージョンと、Sun の JVM バージョン 1.6 が含まれています。 一方、IBM WebSphere Application Server 上で動作する J2EE 用 ColdFusion は、WebSphere に設定されている JVM を使用します。 </p>
<p>異なる JVM を使用するように ColdFusion を設定するには、&lt;ColdFusion のルートディレクトリ&gt;/runtime/lib/jvm.config ファイルをテキストエディタで編集して、java.home の値を、使用する JVM のルートディレクトリを指すように変更します。または、ColdFusion Administrator の [Java と JVM の設定] ページで JVM を変更することもできます。</p>
<p>JVM を切り替えるとソフトウェアの環境が大幅に変更されるため、最初に開発環境またはテスト環境で切り替えてください。また、本番サーバーに変更を加える前に、ColdFusion アプリケーションを十分にテストしてください。 </p>
<p>JVM はメモリ管理を行っているため、JVM の設定方法によってパフォーマンスに大きな影響が出ることがあります。JVM の最も重要な設定は、初期ヒープサイズと最大ヒープサイズです。初期ヒープサイズは JVM が開始時に使用するメモリ量を表し、最大ヒープサイズは JVM が使用できるメモリ量を表します。これらの設定は、ColdFusion Administrator の [Java と JVM の設定] ページで変更できます。[初期メモリサイズ] の設定に初期ヒープサイズを指定し、[最大メモリサイズ] の設定に最大ヒープサイズを指定します。初期ヒープサイズと最大ヒープサイズを指定する JVM 引数は、それぞれ -<samp class="codeph">XmsNm</samp> および <samp class="codeph">-XmxNm</samp> です。ここで、<samp class="codeph">N</samp> にはメガバイト (MB) 単位のヒープサイズを指定します。これらの JVM 引数は、jvm.config ファイル内の java.args 設定の値として保存されます。</p>
<p>デフォルトの最大ヒープサイズは、ColdFusion では 512 MB に設定されています。最高のパフォーマンスを得るには、初期ヒープサイズと最大ヒープサイズを同じ値に設定します。ColdFusion サーバー上でアプリケーションを実行する上で最適なヒープサイズを判断することで、パフォーマンスが向上します。大きすぎる値を設定すると、ガベージコレクションの頻度が高くなり、ヒープが大きいことで必要になる内部メモリ管理が発生してパフォーマンスが低下します。逆に、ヒープサイズに小さすぎる値を設定すると、使用可能であるよりも多いメモリをアプリケーションが使用したときに java.lang.OutOfMemoryError エラーが発生します。 </p>
<p>最適なヒープサイズを最も効果的に判断するには、大きなヒープを割り当てておき、ピーク負荷をシミュレーションした状態でアプリケーションを実行して、アプリケーションが実際に使用するメモリ量を監視します。たとえば、アプリケーションが実際には 180 MB のメモリしか使用していなければ、ヒープサイズを 256 MB に減らすとパフォーマンスが向上する可能性があります。 </p>
<p>java.lang.OutOfMemoryError エラーは、その他のより複雑な条件で発生することがあります。このエラーが発生するよくある原因に、オブジェクトがヒープの Permanent 世代領域を使い切ってしまうことがあります。この領域のデフォルトのサイズは 64 MB です。ColdFusion Administrator の [Java と JVM 設定] ページに次の JVM 引数を追加することで、このサイズを増やすことができます。次の例では 128 MB に増やしています。</p>
<pre>-XX:MaxPermSize=128m.</pre>
<p>ハードウェアの物理メモリは、最適なヒープサイズを判断する上で重要です。最大ヒープサイズを、物理メモリの空き容量より大きく設定すると、パフォーマンスに深刻な悪影響が出ます。たとえば、物理メモリが 512 MB しかない場合、最大ヒープサイズを 512 MB に設定しないでください。オペレーティングシステムや他の実行中のアプリケーションもメモリを使用するため、JVM プロセスが使用できるメモリは 512 MB よりも大幅に少なくなります。これは、ソフトウェアアプリケーションの必要条件に合ったハードウェアを導入することの重要性を示しています。最高の結果を得るために、1 GB 以上の物理メモリを搭載したサーバーハードウェアで実行してください。</p>
<p>サーバーモニタの [要約] ページは、JVM のメモリ使用量を監視します。最適なヒープサイズを判断する際に、この情報を使用します。</p>
</div></div>
<div id="WSc3ff6d0ea77859461172e0811cbf364104-7fb3" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbf364104-7fb3"><!-- --></a><h2 class="topictitle2">変数のメモリ使用量</h2><div><p>クライアント変数を使用する際は、Cookie や RDBMS 使用時のパフォーマンスが最高になるようにクライアント変数ストレージを設定してください。この値は、ColdFusion Administrator の [クライアント変数] ページで設定します。</p>
<p>可能であれば、特に <samp class="codeph">isdefined()</samp> 関数を使用する際は、変数名を完全なスコープで指定することをお勧めします。たとえば、<samp class="codeph">&lt;cfif isdefined("variables.myvariable")&gt;</samp> は <samp class="codeph">&lt;cfif isdefined("myvariable")&gt;</samp> よりもかなりパフォーマンスが向上します。</p>
<p>変数によるメモリ使用量を監視するには、サーバーモニタの<a href="WSc3ff6d0ea77859461172e0811cbf364104-7fb8.html">メモリ使用量</a>のレポートを表示します。</p>
</div></div>
<div id="WSc3ff6d0ea77859461172e0811cbf364104-7fb5" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbf364104-7fb5"><!-- --></a><h2 class="topictitle2">リクエストの処理</h2><div><p>ColdFusion Administrator の [設定] ページにある [同時リクエスト] の設定は、負荷がかかった状態でのアプリケーションのパフォーマンスに最も大きく影響します。この設定は、受信リクエストを同時に処理する際に使用するスレッド数を決定します。ほとんどのアプリケーションにとって、最初は 1 つのプロセッサにつき 3 を設定するのが最適です。デュアルプロセッサコンピュータを使用している場合は、同時リクエストの制限を 6 に設定します。この設定の最適値を判断するには、アプリケーションに負荷をかけてさまざまな値でテストして、負荷をかけた状態で最もパフォーマンスが良い値を見つけます。アプリケーションをテストしている間、平均応答時間をサーバーモニタの [要約] ページに、レポートを<a href="WSc3ff6d0ea77859461172e0811cbf364104-7fba.html">統計情報</a>に表示できます。</p>
</div></div>
<div id="WSc3ff6d0ea77859461172e0811cbf364104-7fb6" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbf364104-7fb6"><!-- --></a><h2 class="topictitle2">キャッシュ</h2><div><p>本番アプリケーションで ColdFusion Administrator の [キャッシュ機能] ページにある [信頼できるキャッシュ] の設定を有効にすると、CFML ソースコードが最後にコンパイルされたときから変更されたかどうかを見るためにサーバーがファイルシステムを確認しないようになります。この設定によって、パフォーマンスに大きく影響するシステム I/O を最小化できます。ColdFusion Administrator の [キャッシュ機能] ページにある [テンプレートキャッシュサイズ] は、通常使用する ColdFusion テンプレートの数にほぼ等しくなるように設定してください。設定がパフォーマンスに影響する度合いを監視するには、サーバーモニタの [リクエストの統計情報] セクションにある<a href="WSEE3AFBDC-AD1A-44dc-8E28-CC4273855B87.html">テンプレートキャッシュのステータス</a>を使用します。</p>
<p>さらに、アプリケーションでは可能な限り次のいずれかの方法でキャッシュを使用してください。</p>
<ul><li><p><samp class="codeph">cfcache</samp> タグ</p>
</li>
<li><p>データベースクエリーのキャッシング。データベースキャッシングはパフォーマンスと拡張性を大幅に向上させます。キャッシングを実行するには、<samp class="codeph">cfquery</samp> タグなどのデータベースタグの <samp class="codeph">cachedwithin</samp> 属性と <samp class="codeph">cachedafter</samp> 属性を使用します。 </p>
</li>
<li><p>データをセッションスコープなどのパーシスタントスコープに格納して、1 回のリクエストよりも長い間使用可能にする方法。</p>
</li>
</ul>
</div></div>
<div id="WSc3ff6d0ea77859461172e0811cbf364104-7fb4" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbf364104-7fb4"><!-- --></a><h2 class="topictitle2">データベース応答時間</h2><div><p>データ操作は、可能な限りデータベースサーバーに実行させることをお勧めします。データ操作を行う SQL コードを追加するほうが、文字列操作やメモリ内クエリー (クエリーオブクエリー) よりもはるかに効率的です。さらに、ストアドプロシージャを使用すると、通常の SQL クエリーよりも一般的にパフォーマンスが向上します。通常、<samp class="codeph">cfquery</samp> 呼び出しのクエリーをストアドプロシージャに変換して <samp class="codeph">cfstoredproc</samp> タグを使用すると、パフォーマンスが向上します。データベース応答時間の情報を表示するには、サーバーモニタの [データベース] セクションを使用します (<a href="WSc3ff6d0ea77859461172e0811cbf364104-7fb7.html">データベース</a>を参照してください)。</p>
</div></div>


<!-- BEGIN USER PREFERENCES -->
          <div id="userprefs">
          </div>
<!-- END USER PREFERENCES -->

          <div id="related">
            
            
            <div class="separator"><a href="#top"><img src="images/BTT.jpg" /></a>&#160;</div>
          </div>
          
</td>
<td width="10px"></td>
<td id="inner_rightcolumn">
<!--#include virtual="rightcolumn.ssi" -->
</td></tr></table>
      </div>

<!-- END CONTENT WRAPPER -->
<!--#include virtual="contentfooter.ssi" -->
</td>
<td id="col3">
    <div>
        <img src="images/adobe-lq.png" />
    </div>
</td>
</tr>
</table>
    </div>
<!-- END PAGE CONTENT WRAPPER -->
<script type="text/javascript">
<!--[CDATA[
scrollToNameAnchor();
// ]]-->
</script> 
<!--#include virtual="/ja_JP/ssi/productmenu.ssi" -->
<style>
#legal-notices{ 
    margin:10px 40px; 
    font-size:11px;
}
</style>



<!--#include virtual="/ja_JP/ssi/localfooter.ssi" -->
<!--#include virtual="footer.ssi" -->
<!--#include virtual="/ubi/analytics/analytics_ssi.html" -->
  </body>
</html>